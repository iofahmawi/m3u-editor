<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ø­Ø±Ø± Ù‚Ø§Ø¦Ù…Ø© ØªØ´ØºÙŠÙ„ M3U/M3U8</title>
    <style>
        /* All CSS is here */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
            color: #333;
            margin: 0;
            padding: 20px;
            direction: rtl;
        }
        .container {
            max-width: 1100px;
            width: 100%;
            margin: 20px auto;
            min-height: 400px;
            background: #fff;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            box-sizing: border-box;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            margin-bottom: 20px;
        }
        .upload-area {
            text-align: center;
            padding: 20px;
            border: 2px dashed #ccc;
            border-radius: 12px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        .upload-area:hover, .upload-area.dragging {
            border-color: #4CAF50;
            background-color: #e8f5e9;
        }
        input[type="file"] {
            display: none;
        }
        .upload-label {
            background-color: #4CAF50;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            display: inline-block;
            transition: background-color 0.3s;
            border: none;
            margin-top: 10px;
        }
        .upload-label:hover {
            background-color: #45a049;
        }
        #urlLoadContainer {
            width: 100%;
            max-width: 600px;
            margin: 20px auto 0 auto;
            text-align: center;
        }
        #urlInput {
            display: none; 
        }
        .action-btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            border: none;
            transition: background-color 0.3s;
            margin: 10px 5px;
            flex-shrink: 0; 
        }
        .action-btn:hover {
            background-color: #0056b3;
        }
        .action-btn.delete-btn { background-color: #f44336; }
        .action-btn.delete-btn:hover { background-color: #d32f2f; }
        #manageGroupsButton, #openSortModalButton, #removeDuplicatesButton, #addChannelButton, #openMergeModalButton, #openExportModalButton {
            display: none; 
        }
        #mainControls {
            text-align: center;
            margin-bottom: 20px;
        }
        .button-row {
            display: flex; 
            justify-content: center; 
            align-items: center;
            flex-wrap: wrap; 
            gap: 10px; 
            margin-bottom: 10px; 
        }
        #initialButtonsRow {
            justify-content: space-between;
        }
        #initialButtonsRow button {
            flex: 1;
            margin: 0;
        }
        @media (max-width: 768px) {
            #mainControls button { width: 45%; margin: 5px 0; }
             #initialButtonsRow { flex-direction: column; }
             #initialButtonsRow button { width: 100%; }
        }
        @media (min-width: 769px) {
            #mainControls button { width: auto; min-width: 150px; }
            #initialButtonsRow button { width: auto; }
        }
        #searchContainer { margin: 20px 0; text-align: center; display: none; }
        #searchInput {
            padding: 10px; width: 300px; max-width: 100%; border: 1px solid #ccc;
            border-radius: 4px; box-sizing: border-box; font-size: 16px;
            outline: none; transition: border-color 0.3s;
        }
        #searchInput:focus { border-color: #4CAF50; }
        #results { text-align: center; }
        table {
            width: 100%; border-collapse: collapse; margin: 20px auto;
            table-layout: fixed;
        }
        th, td {
            border: 1px solid #ddd; padding: 8px; text-align: center;
            box-sizing: border-box; overflow: hidden; vertical-align: middle;
            word-wrap: break-word;
        }
        th { background-color: #4CAF50; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        tbody tr { cursor: pointer; } 
        tbody tr.drag-over-indicator { border-top: 3px solid #4CAF50; }
        tr.selected { background-color: #dcedff !important; }
        table th:nth-child(1), table td:nth-child(1) { width: 12%; min-width: 80px; }
        table th:nth-child(2), table td:nth-child(2) { width: 10%; min-width: 50px; }
        table th:nth-child(3), table td:nth-child(3) { width: 46%; min-width: 100px;}
        table th:nth-child(4), table td:nth-child(4) { width: 20%; min-width: 80px; }
        table th:nth-child(5), table td:nth-child(5) { width: 12%; min-width: 60px; }
        td.logo img { width: 30px; height: 30px; object-fit: contain; display: block; margin: 0 auto; }
        td.logo .placeholder { font-size: 20px; text-align: center; }
        
        td.channel-name, td.channel-group { 
            direction: ltr;
        }
        .channel-name {
            white-space: normal !important; 
            word-break: break-word; 
            overflow: hidden;
        }

        #bulkActionsContainer {
            display: none;
            justify-content: space-between;
            align-items: center;
            background-color: #e8f5e9;
            padding: 8px 15px;
            border-radius: 8px;
            margin: 15px 0 10px 0;
        }
        #bulkActionsButtons {
            display: flex;
            gap: 10px;
        }
        .error-message { color: red; font-weight: bold; margin-top: 15px; text-align: center; }
        .action-button-icon {
            background: none; border: none; cursor: pointer; font-size: 1.2em; margin: 0 1px;
            padding: 5px 3px; display: inline-block; text-align: center; color: #007bff;
            font-weight: bold; transition: color 0.3s;
        }
        .action-button-icon:hover { color: #0056b3; }
        .delete-btn-icon { color: #f44336; }
        .delete-btn-icon:hover { color: #d32f2f; }
        #toastContainer {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            direction: ltr;
        }
        .toast {
            display: flex;
            align-items: center;
            background-color: #fff;
            color: #333;
            padding: 12px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            min-width: 300px;
            opacity: 0;
            transform: translateX(-120%);
            transition: all 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border-left: 5px solid #ccc;
        }
        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }
        .toast.success { border-left-color: #4CAF50; }
        .toast.error { border-left-color: #f44336; }
        .toast.info { border-left-color: #007bff; }
        .toast-content {
            flex-grow: 1;
            margin: 0 10px;
            text-align: right;
        }
        .toast-close {
            background: none;
            border: none;
            color: #aaa;
            font-size: 20px;
            cursor: pointer;
            padding: 0 5px;
        }
        .toast-close:hover {
            color: #333;
        }
        #paginationControls {
            display: flex; justify-content: center; align-items: center;
            margin-top: 20px; gap: 10px;
        }
        #paginationControls button {
            background-color: #f0f0f0; border: 1px solid #ccc; padding: 8px 16px;
            border-radius: 4px; cursor: pointer;
        }
        #paginationControls button:disabled { background-color: #e9ecef; cursor: not-allowed; }
        #pageInfo { font-weight: bold; }
        #confirmModal .modal-content { max-width: 400px; text-align: center; }
        #confirmMessage { margin: 20px 0; font-size: 1.1em; }

        .modal {
            display: none;
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);
            align-items: center;
            justify-content: center;
        }
        /* *** MODIFIED ***: Excluded the findReplaceModal from this rule */
        .modal:not(#addModal, #editModal, #manageGroupsModal, #findReplaceModal) {
            align-items: flex-start;
            padding-top: 15vh;
        }
        .modal-content {
            background-color: #fefefe; padding: 20px;
            border: 1px solid #888; width: auto; max-width: 500px;
            border-radius: 10px; position: relative; box-sizing: border-box;
            overflow-y: auto; min-height: 200px;
            margin: 0;
        }
        .modal-content textarea {
            width: 95%;
            min-height: 150px;
            padding: 8px;
            margin: 10px auto;
            display: block;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            resize: vertical;
        }
        #multiUrlTextarea {
            direction: ltr;
            text-align: left;
        }
        .close {
            color: #aaa; float: left; font-size: 28px; font-weight: bold;
        }
        .close:hover, .close:focus { color: #000; text-decoration: none; cursor: pointer; }
        .modal-content input[type="text"], .modal-content input[type="url"],
        .modal-content input[type="number"], .modal-content select {
            width: 95%; padding: 8px; margin: 10px 0; display: inline-block;
            border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;
        }
        .modal-content input[type="radio"], .modal-content input[type="checkbox"] { margin: 10px 5px; }
        .modal-content button {
            background-color: #4CAF50; color: white; border: none; padding: 8px 12px;
            border-radius: 4px; cursor: pointer; margin-left: 3px;
            box-sizing: border-box; min-width: 80px;
        }
        .modal-content button.cancel { background-color: #f44336; }
        .modal-content button:hover { opacity: 0.8; }
        .modal-row { display: flex; align-items: center; margin-bottom: 10px; }
        .modal-row label { margin-left: 5px; cursor: pointer; }
        .modal-buttons {
            display: flex; justify-content: center; align-items: center; margin-top: 25px;
            flex-wrap: wrap; gap: 10px; width: 100%;
        }
        #loadingIndicator { font-weight: bold; color: #4CAF50; text-align: center; margin: 20px; }
        #logoPreview img, #addPreviewImage { max-width: 50px; max-height: 50px; display: none; }
        #mergeModal .modal-content-body { padding: 15px; text-align: center; }
        #mergeOptionSelector { width: 100%; padding: 10px; font-size: 1em; margin-bottom: 20px; }
        .merge-option-container { padding: 10px; }
        .merge-option-container p { margin-bottom: 20px; color: #666; }
         .merge-option-container button {
             background-color: #007bff; color: white; padding: 10px 25px; font-size: 1em;
         }
         .merge-option-container button:hover { background-color: #0056b3; opacity: 1; }
        
        .status-dot {
            height: 10px;
            width: 10px;
            border-radius: 50%;
            display: none;
            margin-left: 5px;
        }
        body.show-status-dots .status-dot {
            display: inline-block;
        }
        .status-dot.unchecked { background-color: #bbb; }
        .status-dot.checking { background-color: #f0ad4e; animation: blinker 1s linear infinite; }
        .status-dot.checked-ok { background-color: #5cb85c; }
        .status-dot.checked-fail { background-color: #d9534f; }
        @keyframes blinker { 50% { opacity: 0.5; } }
        
        #checker-progress-bar-container {
            width: 100%;
            background-color: #f3f3f3;
            border-radius: 5px;
            margin: 15px 0;
        }
        #checker-progress-bar {
            width: 0%;
            height: 20px;
            background-color: #4CAF50;
            border-radius: 5px;
            text-align: center;
            line-height: 20px;
            color: white;
            transition: width 0.3s;
        }
        .find-replace-options div { margin-bottom: 5px; }

        @media (max-width: 600px) {
            .container { padding: 15px; margin: 10px auto; }
            table { font-size: 14px; }
            th, td { padding: 6px 3px; }
            table th:nth-child(2), table td:nth-child(2) { display: none; }
            
            .modal-content {
                width: 91%;
                padding: 15px;
                margin: 0;
                max-height: 80vh;
            }

            #bulkActionsContainer {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            #bulkActionsButtons {
                display: flex;
                flex-wrap: wrap;
                justify-content: space-between;
                gap: 10px;
                width: 100%;
            }
            #bulkActionsButtons .action-btn {
                margin: 0;
            }
            #bulkActionsButtons .action-btn:nth-child(1),
            #bulkActionsButtons .action-btn:nth-child(2) {
                width: calc(50% - 5px);
            }
            #bulkActionsButtons .action-btn:nth-child(3) {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Ù…Ø­Ø±Ø± Ù‚Ø§Ø¦Ù…Ø© ØªØ´ØºÙŠÙ„ M3U/M3U8</h1>
        
        <div id="loadingIndicator" style="display: none;"><p>Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„...</p></div>
        
        <div id="mainControls">
            <label for="fileInput" id="uploadArea" class="upload-area">
                <p style="font-size: 1.1em; font-weight: bold;">Ø§Ø¶ØºØ· Ù„Ø±ÙØ¹ Ù…Ù„Ù Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</p>
                <span class="upload-label">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù M3U Ø£Ùˆ M3U8</span>
            </label>
            
            <div id="urlLoadContainer">
                 <input type="url" id="urlInput" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù…Ù„Ù M3U/M3U8">
                 <div class="button-row" id="initialButtonsRow">
                    <button class="action-btn" id="loadUrlButton" onclick="openModal('multiUrlModal')">ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø±ÙˆØ§Ø¨Ø·</button>
                    <button class="action-btn" id="createNewPlaylistButton" onclick="createNewPlaylist()">Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                 </div>
            </div>

            <div class="button-row" id="saveAddRow">
                <button class="action-btn" id="openExportModalButton" onclick="openModal('exportModal')">ØªØµØ¯ÙŠØ± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</button>
                <button class="action-btn" id="addChannelButton" onclick="openAddModal()">Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø©</button>
            </div>
            <div class="button-row" id="toolsMergeRow">
                <button class="action-btn" id="openSortModalButton" onclick="openSortModal()">ÙØ±Ø² ÙˆØªØ±ØªÙŠØ¨</button>
                <button class="action-btn" id="manageGroupsButton" onclick="openManageGroupsModal()">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</button>
                <button class="action-btn" id="openMergeModalButton" onclick="openMergeModal()">Ø¯Ù…Ø¬ Ù‚ÙˆØ§Ø¦Ù…</button>
                <button class="action-btn" id="removeDuplicatesButton" onclick="removeDuplicatesManually()">Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±</button>
                <button class="action-btn" id="openChannelCheckerButton" onclick="openChannelCheckerModal()">ÙØ­Øµ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</button>
                <button class="action-btn" id="openFindReplaceButton" onclick="openFindReplaceModal()">Ø¨Ø­Ø« ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„</button>
            </div>
        </div>
        <div id="searchContainer" style="display: none;">
            <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©..." oninput="searchChannels()">
        </div>

        <div id="bulkActionsContainer">
            <span id="selectionCount" style="font-weight: bold;"></span>
            <div id="bulkActionsButtons">
                <button class="action-btn" onclick="openBulkEditGroupModal()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</button>
                <button class="action-btn" onclick="exportSelected()">ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
                <button class="action-btn delete-btn" onclick="deleteSelected()">Ø­Ø°Ù Ø§Ù„Ù…Ø­Ø¯Ø¯</button>
            </div>
        </div>

        <input type="file" id="fileInput" accept=".m3u,.m3u8,.pls" style="display: none;">
        <input type="file" id="mergeFileInput" accept=".m3u,.m3u8,.pls" multiple style="display: none;">
        <div id="results"></div>
        <div id="paginationControls"></div>
    </div>

    <!-- All Modals -->
    <div id="channelCheckerModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('channelCheckerModal')">&times;</span><h2>Ù…Ø¯Ù‚Ù‚ Ø­Ø§Ù„Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h2><p>Ø³ÙŠÙ‚ÙˆÙ… Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ø¨Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„ Ù‚Ù†Ø§Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª ØªØ¹Ù…Ù„. Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ù‡Ø°Ø§ Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª Ù„Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø©.</p><div id="checker-progress-container"><p id="checker-progress-text">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡...</p><div id="checker-progress-bar-container"><div id="checker-progress-bar">0%</div></div></div><p id="checker-summary-text" style="font-weight: bold;"></p><div class="modal-buttons"><button id="start-check-btn" onclick="executeChannelCheck()">Ø¨Ø¯Ø¡ Ø§Ù„ÙØ­Øµ</button><button id="stop-check-btn" onclick="stopChannelCheck()" class="cancel" style="display:none;">Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„ÙØ­Øµ</button></div></div></div>
    <div id="findReplaceModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('findReplaceModal')">&times;</span><h2>Ø¨Ø­Ø« ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„</h2><label for="find-text">Ø¨Ø­Ø« Ø¹Ù†:</label><input type="text" id="find-text"><label for="replace-text">Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¨Ù€:</label><input type="text" id="replace-text"><div class="find-replace-options"><p style="margin-bottom: 5px;"><strong>Ø¨Ø­Ø« ÙÙŠ:</strong></p><div><input type="checkbox" id="find-in-name" checked> <label for="find-in-name">Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©</label></div><div><input type="checkbox" id="find-in-group"> <label for="find-in-group">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label></div><div><input type="checkbox" id="find-in-url"> <label for="find-in-url">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ´ØºÙŠÙ„</label></div></div><div class="find-replace-options" style="margin-top: 15px;"><p style="margin-bottom: 5px;"><strong>Ø§Ù„Ù†Ø·Ø§Ù‚:</strong></p><div><input type="radio" id="replace-scope-all" name="replace-scope" value="all" checked> <label for="replace-scope-all">ÙƒÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</label></div><div><input type="radio" id="replace-scope-selected" name="replace-scope" value="selected"> <label for="replace-scope-selected">Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© ÙÙ‚Ø·</label></div></div><div class="modal-buttons"><button onclick="executeFindAndReplace()">ØªÙ†ÙÙŠØ° Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„</button><button onclick="closeModal('findReplaceModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="multiUrlModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('multiUrlModal')">&times;</span><h2>ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø¹Ø¯Ø© Ø±ÙˆØ§Ø¨Ø·</h2><p>Ø£Ù„ØµÙ‚ Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ù‡Ù†Ø§ØŒ ÙƒÙ„ Ø±Ø§Ø¨Ø· ÙÙŠ Ø³Ø·Ø± Ø¬Ø¯ÙŠØ¯. Ø³ÙŠØªÙ… Ø¯Ù…Ø¬Ù‡Ø§ Ø¨Ø§Ù„ØªØ±ØªÙŠØ¨.</p><textarea id="multiUrlTextarea" placeholder="https://example.com/playlist1.m3u&#10;https://example.com/playlist2.m3u8"></textarea><div class="modal-buttons"><button onclick="processMultiUrlLoad()">ØªØ­Ù…ÙŠÙ„ ÙˆØ¯Ù…Ø¬</button><button onclick="closeModal('multiUrlModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="bulkEditGroupModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('bulkEditGroupModal')">&times;</span><h2>ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</h2><label for="bulkNewGroupName">Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§ÙØµÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª Ø¨Ù€ ;):</label><input type="text" id="bulkNewGroupName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©"><div class="modal-buttons"><button onclick="executeBulkEditGroup()">ØªØ·Ø¨ÙŠÙ‚</button><button onclick="closeModal('bulkEditGroupModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="editModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('editModal')">&times;</span><h2>ØªØ­Ø±ÙŠØ± Ø§Ù„Ù‚Ù†Ø§Ø©</h2><label for="editIndexField">Ø±Ù‚Ù… Ø§Ù„Ù‚Ù†Ø§Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯:</label><input type="number" id="editIndexField" min="1"><label for="editName">Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©:</label><input type="text" id="editName"><label for="editGroup">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù„Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨Ù€ ;):</label><input type="text" id="editGroup"><label for="editLogo">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:</label><input type="url" id="editLogo"><div id="logoPreview"><img id="previewImage"></div><label for="editUrl">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ´ØºÙŠÙ„:</label><input type="url" id="editUrl"><input type="hidden" id="editOriginalIndex"><div class="modal-buttons"><button onclick="saveEdit()">Ø­ÙØ¸</button><button onclick="closeModal('editModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="addModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('addModal')">&times;</span><h2>Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2><label for="addIndexField">Ø±Ù‚Ù… Ø§Ù„Ù‚Ù†Ø§Ø©:</label><input type="number" id="addIndexField" min="1"><label for="addName">Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©:</label><input type="text" id="addName" required><label for="addGroup">Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© (Ù„Ø£ÙƒØ«Ø± Ù…Ù† Ù…Ø¬Ù…ÙˆØ¹Ø©ØŒ Ø§ÙØµÙ„ Ø¨ÙŠÙ†Ù‡Ø§ Ø¨Ù€ ;):</label><input type="text" id="addGroup"><label for="addLogo">Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©:</label><input type="url" id="addLogo"><div id="addLogoPreview"><img id="addPreviewImage"></div><label for="addUrl">Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ´ØºÙŠÙ„:</label><input type="url" id="addUrl" required><div class="modal-buttons"><button onclick="saveNewChannel()">Ø¥Ø¶Ø§ÙØ©</button><button onclick="closeModal('addModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="removeDuplicatesModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('removeDuplicatesModal')">&times;</span><h2>Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªÙƒØ±Ø§Ø±</h2><label>Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±Ø·:</label><div class="modal-row"><input type="radio" id="crit-name" name="duplicateCriteria" value="name" checked><label for="crit-name">Ø§Ù„Ø§Ø³Ù… ÙÙ‚Ø·</label></div><div class="modal-row"><input type="radio" id="crit-name-url" name="duplicateCriteria" value="name-url"><label for="crit-name-url">Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø±Ø§Ø¨Ø·</label></div><div class="modal-row"><input type="radio" id="crit-name-url-group" name="duplicateCriteria" value="name-url-group"><label for="crit-name-url-group">Ø§Ù„Ø§Ø³Ù… + Ø§Ù„Ø±Ø§Ø¨Ø· + Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label></div><div class="modal-buttons"><button onclick="executeRemoveDuplicates()">Ø¥Ø²Ø§Ù„Ø©</button><button onclick="closeModal('removeDuplicatesModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="sortModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('sortModal')">&times;</span><h2>ÙØ±Ø² ÙˆØªØ±ØªÙŠØ¨ Ø§Ù„Ù‚Ù†ÙˆØ§Øª</h2><div class="modal-row"><input type="radio" id="sort-alpha" name="sortCriteria" value="alphabetical" checked onchange="handleSortCriteriaChange()"><label for="sort-alpha">Ø£Ø¨Ø¬Ø¯ÙŠ</label></div><div class="modal-row"><input type="radio" id="sort-name" name="sortCriteria" value="name" onchange="handleSortCriteriaChange()"><label for="sort-name">Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©</label></div><div id="sortByNameInputContainer" style="display: none; margin-right: 25px;"><input type="text" id="sortByNameField" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø© (Ù…Ø«Ø§Ù„: mbc)"></div><div class="modal-row"><input type="radio" id="sort-group" name="sortCriteria" value="group" onchange="handleSortCriteriaChange()"><label for="sort-group">Ø­Ø³Ø¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label></div><div id="sortByGroupInputContainer" style="display: none; margin-right: 25px;"><input type="text" id="sortByGroupField" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©"></div><div class="modal-buttons"><button onclick="executeSort()">ØªØ·Ø¨ÙŠÙ‚</button><button onclick="closeModal('sortModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="manageGroupsModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('manageGroupsModal')">&times;</span><h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§Øª</h2><label for="groupSelector">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©:</label><select id="groupSelector"></select><label>Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡:</label><div class="modal-row"><input type="radio" id="action-rename" name="groupAction" value="rename" checked onchange="handleGroupActionChange()"><label for="action-rename">Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ©</label></div><div id="renameGroupInputContainer" style="margin-right: 25px;"><input type="text" id="newGroupNameField" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø§ÙØµÙ„ Ø¨Ù€ ;)"></div><div class="modal-row"><input type="radio" id="action-delete" name="groupAction" value="delete" onchange="handleGroupActionChange()"><label for="action-delete">Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label></div><div class="modal-row"><input type="radio" id="action-remove-all-groups" name="groupAction" value="removeAll" onchange="handleGroupActionChange()"><label for="action-remove-all-groups">Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</label></div><div class="modal-row"><input type="radio" id="action-split" name="groupAction" value="split" onchange="handleGroupActionChange()"><label for="action-split">ÙØµÙ„ Ø£Ùˆ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</label></div><div class="modal-buttons"><button onclick="executeGroupAction()">ØªÙ†ÙÙŠØ°</button><button onclick="closeModal('manageGroupsModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="mergeModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('mergeModal')">&times;</span><h2>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¯Ù…Ø¬</h2><div class="modal-content-body"><label for="mergeOptionSelector" style="display:block; margin-bottom: 5px; text-align: right;">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯Ù…Ø¬:</label><select id="mergeOptionSelector" onchange="handleMergeOptionChange()"><option value="file" selected>Ù…Ù† Ù…Ù„Ù</option><option value="url">Ù…Ù† Ø±Ø§Ø¨Ø·</option></select><div id="mergeFileOption" class="merge-option-container" style="display: block;"><p>Ø§Ø®ØªØ± Ù…Ù„Ù Ø£Ùˆ Ø£ÙƒØ«Ø± Ù„Ø¯Ù…Ø¬Ù‡ Ù…Ø¹ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©.</p><button onclick="document.getElementById('mergeFileInput').click()">Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„ÙØ§Øª</button></div><div id="mergeUrlOption" class="merge-option-container" style="display: none;"><p>Ø£Ø¯Ø®Ù„ Ø±Ø§Ø¨Ø· Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„ÙŠØªÙ… Ø¯Ù…Ø¬Ù‡Ø§.</p><input type="url" id="mergeUrlInput" placeholder="https://example.com/playlist.m3u" style="width: 100%; margin-bottom: 20px;"><button onclick="executeMerge()">Ø¯Ù…Ø¬ Ø§Ù„Ø±Ø§Ø¨Ø·</button></div></div></div></div>
    <div id="exportModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('exportModal')">&times;</span><h2>ØªØµØ¯ÙŠØ± Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ´ØºÙŠÙ„</h2><p>Ø§Ø®ØªØ± Ø§Ù„ØµÙŠØºØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù„Ù„Ø­ÙØ¸:</p><div class="modal-row"><input type="radio" id="export-m3u" name="exportFormat" value="m3u" checked><label for="export-m3u">M3U</label></div><div class="modal-row"><input type="radio" id="export-m3u8" name="exportFormat" value="m3u8"><label for="export-m3u8">M3U8</label></div><div class="modal-row"><input type="radio" id="export-pls" name="exportFormat" value="pls"><label for="export-pls">PLS</label></div><div class="modal-buttons"><button onclick="executeExport()">ØªØµØ¯ÙŠØ±</button><button onclick="closeModal('exportModal')" class="cancel">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="confirmModal" class="modal"><div class="modal-content"><span class="close" onclick="closeModal('confirmModal')">&times;</span><h2 id="confirmTitle">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡</h2><p id="confirmMessage">Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ</p><div class="modal-buttons"><button id="confirmBtn" class="action-btn">ØªØ£ÙƒÙŠØ¯</button><button onclick="closeModal('confirmModal')" class="action-btn delete-btn">Ø¥Ù„ØºØ§Ø¡</button></div></div></div>
    <div id="toastContainer"></div>

    <script>
        let channelsData = []; let displayedChannels = []; let isMerged = false, isSorted = false; let draggedIndices = []; let selectedIndices = new Set(); let currentPage = 1; const rowsPerPage = 100; let isChecking = false;
        function openModal(modalId) { const modal = document.getElementById(modalId); if(modal) modal.style.display = 'flex'; }
        function closeModal(modalId) { if(modalId === 'channelCheckerModal' && isChecking) { stopChannelCheck(); } const modal = document.getElementById(modalId); if(modal) modal.style.display = 'none'; }
        function handleDragStart(e) { e.currentTarget.style.cursor = 'grabbing'; const startIndex = parseInt(e.currentTarget.dataset.index); if (selectedIndices.has(startIndex)) { draggedIndices = Array.from(selectedIndices).sort((a, b) => a - b); } else { selectedIndices.clear(); selectedIndices.add(startIndex); draggedIndices = [startIndex]; document.querySelectorAll('tr.selected').forEach(row => row.classList.remove('selected')); e.currentTarget.classList.add('selected'); updateBulkActionsUI(); } }
        function handleDragEnter(e) { e.preventDefault(); const targetRow = e.currentTarget; const targetIndex = parseInt(targetRow.dataset.index); if (!draggedIndices.includes(targetIndex)) { targetRow.classList.add('drag-over-indicator'); } }
        function handleDragLeave(e) { e.currentTarget.classList.remove('drag-over-indicator'); }
        function handleDragOver(e) { e.preventDefault(); }
        function handleDrop(e) { e.preventDefault(); e.currentTarget.classList.remove('drag-over-indicator'); const dropIndex = parseInt(e.currentTarget.dataset.index); if (draggedIndices.length === 0 || draggedIndices.includes(dropIndex)) { draggedIndices = []; return; } const draggedItems = draggedIndices.map(index => channelsData[index]); for (let i = draggedIndices.length - 1; i >= 0; i--) { channelsData.splice(draggedIndices[i], 1); } const itemsBeforeDrop = draggedIndices.filter(index => index < dropIndex).length; const newDropIndex = dropIndex - itemsBeforeDrop; channelsData.splice(newDropIndex, 0, ...draggedItems); draggedIndices = []; selectedIndices.clear(); updateBulkActionsUI(); updateTvgChnoInAllChannels(); searchChannels(); showToast(`ØªÙ… Ù†Ù‚Ù„ ${draggedItems.length} Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success'); }
        document.addEventListener('DOMContentLoaded', () => { document.getElementById('uploadArea').style.display = 'block'; document.getElementById('urlLoadContainer').style.display = 'block'; document.getElementById('saveAddRow').style.display = 'none'; document.getElementById('toolsMergeRow').style.display = 'none'; document.getElementById('searchContainer').style.display = 'none'; ['openExportModalButton', 'addChannelButton', 'openSortModalButton', 'manageGroupsButton', 'openMergeModalButton', 'removeDuplicatesButton'].forEach(id => { const button = document.getElementById(id); if (button) button.style.display = 'none'; }); document.getElementById('results').innerHTML = ''; });
        document.getElementById('fileInput').addEventListener('change', handleFileSelect);
        document.getElementById('mergeFileInput').addEventListener('change', mergePlaylists);
        function showToast(message, type = 'info', duration = 4000) { const container = document.getElementById('toastContainer'); const toast = document.createElement('div'); toast.className = `toast ${type}`; const cleanMessage = message.trim().replace(/\.$/, ''); toast.innerHTML = `<div class="toast-content">${cleanMessage}</div><button class="toast-close">&times;</button>`; container.appendChild(toast); const closeButton = toast.querySelector('.toast-close'); const removeToast = () => { toast.classList.remove('show'); setTimeout(() => { if (container.contains(toast)) container.removeChild(toast); }, 500); }; closeButton.onclick = removeToast; setTimeout(() => toast.classList.add('show'), 10); setTimeout(removeToast, duration); }
        function showConfirm(title, message, onConfirm) { document.getElementById('confirmTitle').textContent = title; document.getElementById('confirmMessage').textContent = message; const confirmBtn = document.getElementById('confirmBtn'); const newConfirmBtn = confirmBtn.cloneNode(true); confirmBtn.parentNode.replaceChild(newConfirmBtn, confirmBtn); newConfirmBtn.onclick = () => { onConfirm(); closeModal('confirmModal'); }; openModal('confirmModal'); }
        function handleRowClick(event) { const row = event.currentTarget; if (event.target.closest('.action-button-icon')) return; const index = parseInt(row.dataset.index); if (selectedIndices.has(index)) { selectedIndices.delete(index); row.classList.remove('selected'); } else { selectedIndices.add(index); row.classList.add('selected'); } updateBulkActionsUI(); }
        function updateBulkActionsUI() { const bulkActionsContainer = document.getElementById('bulkActionsContainer'); const selectionCountSpan = document.getElementById('selectionCount'); const count = selectedIndices.size; if (count > 0) { bulkActionsContainer.style.display = 'flex'; selectionCountSpan.textContent = `ØªÙ… ØªØ­Ø¯ÙŠØ¯ ${count} Ù‚Ù†Ø§Ø©`; } else { bulkActionsContainer.style.display = 'none'; } }
        function deleteSelected() { const count = selectedIndices.size; if (count === 0) return; showConfirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù', `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ${count} Ù‚Ù†Ø§Ø©ØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡.`, () => { const indicesToDelete = Array.from(selectedIndices).sort((a, b) => b - a); indicesToDelete.forEach(index => { channelsData.splice(index, 1); }); selectedIndices.clear(); updateTvgChnoInAllChannels(); searchChannels(); showToast(`ØªÙ… Ø­Ø°Ù ${count} Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success'); }); }
        function handleFileSelect(event) { document.body.classList.remove('show-status-dots'); const file = event.target.files[0]; if (!file) return; const fileName = file.name.toLowerCase(); if (!/\.(m3u|m3u8|pls)$/.test(fileName)) { return showToast("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø§Ù…ØªØ¯Ø§Ø¯ M3U, M3U8, Ø£Ùˆ PLS", "error"); } document.getElementById('loadingIndicator').style.display = 'block'; const reader = new FileReader(); reader.onload = function(e) { channelsData = parsePlaylist(e.target.result); if (channelsData.length > 0) { showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${channelsData.length} Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success'); displayedChannels = [...channelsData]; updateTvgChnoInAllChannels(); displayPaginatedChannels(); showPlaylistControls(); isMerged = false; isSorted = false; } else { showToast("Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‚Ù†ÙˆØ§Øª ØµØ§Ù„Ø­Ø©", "error"); } document.getElementById('loadingIndicator').style.display = 'none'; }; reader.readAsText(file, 'UTF-8'); }
        function displayPaginatedChannels() { const totalPages = Math.ceil(displayedChannels.length / rowsPerPage); currentPage = Math.max(1, Math.min(currentPage, totalPages)); const startIndex = (currentPage - 1) * rowsPerPage; const endIndex = startIndex + rowsPerPage; const pagedChannels = displayedChannels.slice(startIndex, endIndex); renderTable(pagedChannels, startIndex); setupPaginationControls(totalPages); updateBulkActionsUI(); }
        function renderTable(channels, startIndex) { const resultsDiv = document.getElementById('results'); resultsDiv.innerHTML = ''; if (channelsData.length === 0) { resultsDiv.innerHTML = '<p>Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ÙØ§Ø±ØºØ©. Ø£Ø¶Ù Ù‚Ù†Ø§Ø© Ø£Ùˆ Ù‚Ù… Ø¨ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù.</p>'; return; } if (channels.length === 0) { resultsDiv.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø© Ù„Ù„Ø¨Ø­Ø«.</p>'; return; } const table = document.createElement('table'); const tbody = document.createElement('tbody'); table.innerHTML = `<thead><tr><th>Ø±Ù‚Ù…</th><th>Ø§Ù„ØµÙˆØ±Ø©</th><th>Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©</th><th>Ø¥Ø¯Ø§Ø±Ø©</th></tr></thead>`; channels.forEach((channel, index) => { const originalIndex = channelsData.indexOf(channel); const row = tbody.insertRow(); row.setAttribute('draggable', 'true'); row.dataset.index = originalIndex; if (selectedIndices.has(originalIndex)) { row.classList.add('selected'); } const groupsDisplay = channel.groups && channel.groups.length > 0 ? channel.groups.join(', ') : 'ØºÙŠØ± Ù…ØµÙ†ÙØ©'; row.innerHTML = `<td><span class="status-dot ${channel.status || 'unchecked'}" data-index="${originalIndex}"></span>${startIndex + index + 1}</td><td class="logo">${channel.logo ? `<img src="${channel.logo}" alt="Logo" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">` : ''}<span class="placeholder" style="${channel.logo ? 'display:none;' : ''}">ğŸ“º</span></td><td class="channel-name">${channel.name || ''}</td><td class="channel-group">${groupsDisplay}</td><td class="actions"><button class="action-button-icon edit-btn" data-index="${originalIndex}" title="ØªØ­Ø±ÙŠØ±">&#9998;</button><button class="action-button-icon delete-btn-icon" data-index="${originalIndex}" title="Ø­Ø°Ù">&#128465;</button></td>`; row.addEventListener('click', handleRowClick); row.addEventListener('dragstart', handleDragStart); row.addEventListener('dragenter', handleDragEnter); row.addEventListener('dragleave', handleDragLeave); row.addEventListener('dragover', handleDragOver); row.addEventListener('drop', handleDrop); }); table.appendChild(tbody); resultsDiv.appendChild(table); }
        function setupPaginationControls(totalPages) { const container = document.getElementById('paginationControls'); container.innerHTML = ''; if (totalPages <= 1) return; container.innerHTML = `<button id="prevPage" onclick="changePage(-1)" ${currentPage === 1 ? 'disabled' : ''}>Ø§Ù„Ø³Ø§Ø¨Ù‚</button><span id="pageInfo">ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}</span><button id="nextPage" onclick="changePage(1)" ${currentPage === totalPages ? 'disabled' : ''}>Ø§Ù„ØªØ§Ù„ÙŠ</button>`; }
        function changePage(direction) { currentPage += direction; displayPaginatedChannels(); }
        function searchChannels() { const term = document.getElementById('searchInput').value.toLowerCase(); if (!term) { displayedChannels = [...channelsData]; } else { displayedChannels = channelsData.filter(ch => (ch.name || '').toLowerCase().includes(term) || (ch.groups && ch.groups.join(' ').toLowerCase().includes(term))); } currentPage = 1; displayPaginatedChannels(); }
        function parsePlaylist(content) { const lines = content.split('\n'); const channels = []; let currentInfo = ''; for (const line of lines) { const trimmedLine = line.trim(); if (trimmedLine.startsWith('#EXTINF')) { currentInfo = trimmedLine; } else if (currentInfo && !trimmedLine.startsWith('#') && trimmedLine.length > 0) { const name = currentInfo.match(/,([^,]*)$/)?.[1].trim() || 'Ù‚Ù†Ø§Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©'; const logo = currentInfo.match(/tvg-logo="([^"]*)"/i)?.[1] || ''; const chno = parseInt(currentInfo.match(/tvg-chno="([^"]*)"/i)?.[1]) || 0; const groupString = currentInfo.match(/group-title="([^"]*)"/i)?.[1] || ''; const groups = groupString ? groupString.split(';').map(g => g.trim()).filter(g => g) : []; channels.push({ name, groups, logo, chno, url: trimmedLine, originalExtinf: currentInfo, status: 'unchecked' }); currentInfo = ''; } } return channels; }
        async function mergePlaylists(event) { const files = event.target.files; if (!files.length) return; closeModal('mergeModal'); document.getElementById('loadingIndicator').style.display = 'block'; const newChannels = await Promise.all(Array.from(files).map(file => file.text().then(parsePlaylist))).then(results => results.flat()); channelsData.push(...newChannels); const duplicatesRemoved = removeDuplicates('name-url'); updateTvgChnoInAllChannels(); searchChannels(); document.getElementById('loadingIndicator').style.display = 'none'; event.target.value = ''; isMerged = true; isSorted = false; showToast(`ØªÙ… Ø¯Ù…Ø¬ ${newChannels.length} Ù‚Ù†Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØ¥Ø²Ø§Ù„Ø© ${duplicatesRemoved} Ù‚Ù†Ø§Ø© Ù…ÙƒØ±Ø±Ø©`, 'success'); }
        function removeDuplicates(criteria = 'name') { const originalLength = channelsData.length; const seen = new Set(); channelsData = channelsData.filter(channel => { let key; const name = (channel.name || '').trim(); const url = (channel.url || '').trim(); const groupKey = (channel.groups || []).join(';'); if (criteria === 'name-url') key = `${name}-${url}`; else if (criteria === 'name') key = name; else if (criteria === 'name-url-group') key = `${name}-${url}-${groupKey}`; if (key && !seen.has(key)) { seen.add(key); return true; } return false; }); return originalLength - channelsData.length; }
        function removeDuplicatesManually() { if (channelsData.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª", 'error'); openModal('removeDuplicatesModal'); }
        function executeRemoveDuplicates() { const criteria = document.querySelector('input[name="duplicateCriteria"]:checked').value; const duplicatesRemoved = removeDuplicates(criteria); updateTvgChnoInAllChannels(); searchChannels(); closeModal('removeDuplicatesModal'); showToast(`ØªÙ… Ø¥Ø²Ø§Ù„Ø© ${duplicatesRemoved} Ù‚Ù†Ø§Ø© Ù…ÙƒØ±Ø±Ø©`, 'success'); }
        function openMultiUrlModal() { document.getElementById('multiUrlTextarea').value = ''; openModal('multiUrlModal'); }
        async function processMultiUrlLoad() { document.body.classList.remove('show-status-dots'); const urlsText = document.getElementById('multiUrlTextarea').value; const urls = urlsText.split('\n').map(u => u.trim()).filter(u => u); if (urls.length === 0) { return showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„", "error"); } closeModal('multiUrlModal'); document.getElementById('loadingIndicator').style.display = 'block'; let allNewChannels = []; let failedCount = 0; for (const url of urls) { try { const response = await fetch(url); if (!response.ok) throw new Error(`ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· (Ø§Ù„Ø­Ø§Ù„Ø©: ${response.status})`); const content = await response.text(); const channelsFromUrl = parsePlaylist(content); allNewChannels.push(...channelsFromUrl); } catch (error) { failedCount++; console.error(`Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· ${url}:`, error); } } document.getElementById('loadingIndicator').style.display = 'none'; if (allNewChannels.length > 0) { channelsData = allNewChannels; isMerged = urls.length > 1; isSorted = false; updateTvgChnoInAllChannels(); searchChannels(); showPlaylistControls(); let successMessage = `ØªÙ… ØªØ­Ù…ÙŠÙ„ ${channelsData.length} Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­ Ù…Ù† ${urls.length - failedCount} Ø±Ø§Ø¨Ø·.`; if (failedCount > 0) { successMessage += ` ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ ${failedCount} Ø±Ø§Ø¨Ø·.`; } showToast(successMessage, 'success'); } else { showToast("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø£ÙŠ Ù‚Ù†ÙˆØ§Øª Ù…Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ù‚Ø¯Ù…Ø©", "error"); } }
        function createNewPlaylist() { document.body.classList.remove('show-status-dots'); channelsData = []; displayedChannels = []; selectedIndices.clear(); showPlaylistControls(); displayPaginatedChannels(); showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙØ§Ø±ØºØ©', 'info'); }
        function executeSort() { const criteria = document.querySelector('input[name="sortCriteria"]:checked').value; const sortFunction = (a, b) => (a.name || '').localeCompare(b.name || '', 'ar'); if (criteria === 'alphabetical') { channelsData.sort(sortFunction); } else if (criteria === 'name') { const term = document.getElementById('sortByNameField').value.toLowerCase().trim(); if (term) channelsData.sort((a, b) => (b.name.toLowerCase().includes(term) - a.name.toLowerCase().includes(term)) || sortFunction(a, b)); } else if (criteria === 'group') { const term = document.getElementById('sortByGroupField').value.toLowerCase().trim(); if (term) channelsData.sort((a, b) => { const aHasGroup = a.groups && a.groups.some(g => g.toLowerCase().includes(term)); const bHasGroup = b.groups && b.groups.some(g => g.toLowerCase().includes(term)); return (bHasGroup - aHasGroup) || sortFunction(a, b); }); } isSorted = true; isMerged = false; updateTvgChnoInAllChannels(); searchChannels(); closeModal('sortModal'); }
        function executeGroupAction() { const action = document.querySelector('input[name="groupAction"]:checked').value; if (action === 'removeAll') { showConfirm('Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª', 'Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø§ØªØŸ Ø³ØªØµØ¨Ø­ ÙƒÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª ØºÙŠØ± Ù…ØµÙ†ÙØ©.', () => { channelsData.forEach(channel => { channel.groups = []; }); showToast('ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success'); updateTvgChnoInAllChannels(); searchChannels(); closeModal('manageGroupsModal'); }); return; } const selectedGroup = document.getElementById('groupSelector').value; const isUncategorized = selectedGroup === 'ØºÙŠØ± Ù…ØµÙ†ÙØ©'; if (action === 'delete') { showConfirm('Ø­Ø°Ù Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù ÙƒÙ„ Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© "${selectedGroup}"ØŸ`, () => { const originalCount = channelsData.length; channelsData = channelsData.filter(channel => { if (isUncategorized) { return channel.groups && channel.groups.length > 0; } return !channel.groups || !channel.groups.includes(selectedGroup); }); const removedCount = originalCount - channelsData.length; showToast(`ØªÙ… Ø­Ø°Ù ${removedCount} Ù‚Ù†Ø§Ø© Ù…Ù† Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©`, 'success'); updateTvgChnoInAllChannels(); searchChannels(); closeModal('manageGroupsModal'); }); } else if (action === 'rename') { const newGroupNameString = document.getElementById('newGroupNameField').value.trim(); if (!newGroupNameString) { showToast('Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºÙ‹Ø§', 'error'); return; } const newGroups = newGroupNameString.split(';').map(g => g.trim()).filter(g => g); channelsData.forEach(channel => { const isTargeted = isUncategorized ? (!channel.groups || channel.groups.length === 0) : (channel.groups && channel.groups.includes(selectedGroup)); if (isTargeted) { const currentGroups = new Set(channel.groups || []); if (!isUncategorized) { currentGroups.delete(selectedGroup); } newGroups.forEach(g => currentGroups.add(g)); channel.groups = Array.from(currentGroups); } }); showToast(`ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ³Ù…ÙŠØ© Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success'); updateTvgChnoInAllChannels(); searchChannels(); closeModal('manageGroupsModal'); } else if (action === 'split') { const groupChannels = channelsData.filter(channel => { if (isUncategorized) return !channel.groups || channel.groups.length === 0; return channel.groups && channel.groups.includes(selectedGroup); }); if (groupChannels.length > 0) { const content = '#EXTM3U\n' + groupChannels.map(ch => `${buildUpdatedExtinf(ch.originalExtinf, ch.groups, ch.logo, ch.name, ch.chno)}\n${ch.url}`).join('\n\n'); const fileName = `Group_${selectedGroup.replace(/[\/\\?%*:|"<>]/g, '-')}.m3u`; downloadFile(content, fileName, 'text/plain;charset=utf-8'); } else { showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‚Ù†ÙˆØ§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹Ø©', 'info'); } closeModal('manageGroupsModal'); } }
        function executeMerge() { const url = document.getElementById('mergeUrlInput').value; if (!url) return showToast("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ø§Ø¨Ø· Ù„Ù„Ø¯Ù…Ø¬", 'error'); closeModal('mergeModal'); document.getElementById('loadingIndicator').style.display = 'block'; fetch(url).then(response => { if (!response.ok) throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù'); return response.text(); }).then(content => { const newChannels = parsePlaylist(content); if (newChannels.length === 0) return showToast("Ø§Ù„Ø±Ø§Ø¨Ø· Ù„Ø§ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù‚Ù†ÙˆØ§Øª", "error"); channelsData.push(...newChannels); const duplicatesRemoved = removeDuplicates('name-url'); showToast(`ØªÙ… Ø¯Ù…Ø¬ ${newChannels.length} Ù‚Ù†Ø§Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· ÙˆØ¥Ø²Ø§Ù„Ø© ${duplicatesRemoved} Ù‚Ù†Ø§Ø© Ù…ÙƒØ±Ø±Ø©`, 'success'); isMerged = true; isSorted = false; updateTvgChnoInAllChannels(); searchChannels(); }).catch(error => showToast(`Ø®Ø·Ø£: ${error.message}`, 'error')).finally(() => document.getElementById('loadingIndicator').style.display = 'none'); }
        function deleteChannel(index) { showConfirm('ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø­Ø°Ù', `Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù: ${channelsData[index].name}ØŸ`, () => { channelsData.splice(index, 1); updateTvgChnoInAllChannels(); searchChannels(); showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success'); }); }
        function saveEdit() { const originalIndex = parseInt(document.getElementById('editOriginalIndex').value); let newIndex = parseInt(document.getElementById('editIndexField').value) - 1; if (!document.getElementById('editName').value || !document.getElementById('editUrl').value) return showToast("Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ù„ÙˆØ¨Ø§Ù†", 'error'); const groups = document.getElementById('editGroup').value.split(';').map(g => g.trim()).filter(g => g); const channel = { name: document.getElementById('editName').value, groups: groups, logo: document.getElementById('editLogo').value, url: document.getElementById('editUrl').value, originalExtinf: channelsData[originalIndex].originalExtinf, status: channelsData[originalIndex].status }; if (newIndex !== originalIndex && newIndex < channelsData.length) { channelsData.splice(originalIndex, 1); channelsData.splice(newIndex, 0, channel); } else { channelsData[originalIndex] = channel; } updateTvgChnoInAllChannels(); closeModal('editModal'); searchChannels(); }
        function saveNewChannel() { if (!document.getElementById('addName').value || !document.getElementById('addUrl').value) return showToast("Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ø§Ø¨Ø· Ù…Ø·Ù„ÙˆØ¨Ø§Ù†", 'error'); let newIndex = parseInt(document.getElementById('addIndexField').value) - 1; const groups = document.getElementById('addGroup').value.split(';').map(g => g.trim()).filter(g => g); const newChannel = { name: document.getElementById('addName').value, groups: groups, logo: document.getElementById('addLogo').value, url: document.getElementById('addUrl').value, status: 'unchecked' }; if (newIndex >= 0 && newIndex <= channelsData.length) { channelsData.splice(newIndex, 0, newChannel); } else { channelsData.push(newChannel); } updateTvgChnoInAllChannels(); closeModal('addModal'); searchChannels(); showToast('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success'); }
        function openAddModal() { document.getElementById('addIndexField').value = channelsData.length + 1; ['addName', 'addGroup', 'addLogo', 'addUrl'].forEach(id => document.getElementById(id).value = ''); updateLogoPreview('addPreviewImage', ''); openModal('addModal'); }
        function openEditModal(index) { const channel = channelsData[index]; document.getElementById('editIndexField').value = index + 1; document.getElementById('editName').value = channel.name || ''; document.getElementById('editGroup').value = (channel.groups || []).join(';'); document.getElementById('editLogo').value = channel.logo || ''; document.getElementById('editUrl').value = channel.url || ''; document.getElementById('editOriginalIndex').value = index; updateLogoPreview('previewImage', channel.logo); openModal('editModal'); }
        function openSortModal() { if (channelsData.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„ÙØ±Ø²Ù‡Ø§", "error"); openModal('sortModal'); }
        function handleSortCriteriaChange() { const criteria = document.querySelector('input[name="sortCriteria"]:checked').value; document.getElementById('sortByNameInputContainer').style.display = criteria === 'name' ? 'block' : 'none'; document.getElementById('sortByGroupInputContainer').style.display = criteria === 'group' ? 'block' : 'none'; }
        function openManageGroupsModal() { if (channelsData.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„Ø¥Ø¯Ø§Ø±Ø© Ù…Ø¬Ù…ÙˆØ¹Ø§ØªÙ‡Ø§", "error"); const groupSelector = document.getElementById('groupSelector'); groupSelector.innerHTML = ''; const allGroups = channelsData.flatMap(ch => (ch.groups && ch.groups.length) ? ch.groups : ['ØºÙŠØ± Ù…ØµÙ†ÙØ©']); const uniqueGroups = [...new Set(allGroups)]; uniqueGroups.sort((a, b) => a.localeCompare(b, 'ar')).forEach(group => { const option = document.createElement('option'); option.value = group; option.textContent = group; groupSelector.appendChild(option); }); handleGroupActionChange(); openModal('manageGroupsModal'); }
        function handleGroupActionChange() { const action = document.querySelector('input[name="groupAction"]:checked').value; const renameContainer = document.getElementById('renameGroupInputContainer'); const groupSelector = document.getElementById('groupSelector'); const groupSelectorLabel = document.querySelector('#manageGroupsModal label[for="groupSelector"]'); const isGroupSpecificAction = action === 'rename' || action === 'delete' || action === 'split'; groupSelector.style.display = isGroupSpecificAction ? 'block' : 'none'; groupSelectorLabel.style.display = isGroupSpecificAction ? 'block' : 'none'; renameContainer.style.display = action === 'rename' ? 'block' : 'none'; }
        function openMergeModal() { if (channelsData.length === 0) return showToast("ÙŠØ¬Ø¨ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø¯Ù…Ø¬ Ù…Ø¹Ù‡Ø§", "error"); document.getElementById('mergeUrlInput').value = ''; document.getElementById('mergeOptionSelector').value = 'file'; handleMergeOptionChange(); openModal('mergeModal'); }
        function handleMergeOptionChange() { const selectedOption = document.getElementById('mergeOptionSelector').value; document.getElementById('mergeFileOption').style.display = (selectedOption === 'file') ? 'block' : 'none'; document.getElementById('mergeUrlOption').style.display = (selectedOption === 'url') ? 'block' : 'none'; }
        function showPlaylistControls() { document.getElementById('uploadArea').style.display = 'none'; document.getElementById('urlLoadContainer').style.display = 'none'; document.getElementById('saveAddRow').style.display = 'flex'; document.getElementById('toolsMergeRow').style.display = 'flex'; document.getElementById('searchContainer').style.display = 'block'; ['openExportModalButton', 'addChannelButton', 'openSortModalButton', 'manageGroupsButton', 'openMergeModalButton', 'removeDuplicatesButton'].forEach(id => { const button = document.getElementById(id); if (button) button.style.display = 'inline-block'; }); }
        function updateLogoPreview(imgId, url) { const preview = document.getElementById(imgId); preview.style.display = url ? 'block' : 'none'; if(url) preview.src = url; preview.onerror = () => preview.style.display = 'none'; }
        document.getElementById('editLogo').addEventListener('input', e => updateLogoPreview('previewImage', e.target.value)); document.getElementById('addLogo').addEventListener('input', e => updateLogoPreview('addPreviewImage', e.target.value));
        function buildUpdatedExtinf(originalExtinf, groups, logo, name, chno) { let line = originalExtinf ? originalExtinf.replace(/,.*$/, '').split(/\s+/).filter(p => !p.toLowerCase().startsWith('group-title=') && !p.toLowerCase().startsWith('tvg-logo=') && !p.toLowerCase().startsWith('tvg-chno=')).join(' ') : '#EXTINF:-1'; if (chno) line += ` tvg-chno="${chno}"`; if (logo) line += ` tvg-logo="${logo}"`; if (groups && groups.length > 0) line += ` group-title="${groups.join(';')}"`; return `${line},${name}`; }
        function updateTvgChnoInAllChannels() { channelsData.forEach((channel, index) => { channel.chno = index + 1; channel.originalExtinf = buildUpdatedExtinf(channel.originalExtinf, channel.groups, channel.logo, channel.name, channel.chno); }); }
        function openExportModal() { if (channelsData.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§", "error"); openModal('exportModal'); }
        function executeExport() { const format = document.querySelector('input[name="exportFormat"]:checked').value; if (format === 'm3u') savePlaylist(); else if (format === 'm3u8') savePlaylistAsM3u8(); else if (format === 'pls') savePlaylistAsPls(); closeModal('exportModal'); }
        const createPlaylistContent = (type, channelsToExport = channelsData) => { if (channelsToExport.length === 0) { showToast("Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„Ù„Ø­ÙØ¸", "error"); return null; } if (type === 'pls') { return '[playlist]\nNumberOfEntries=' + channelsToExport.length + '\nVersion=2\n' + channelsToExport.map((ch, i) => `File${i+1}=${ch.url}\nTitle${i+1}=${ch.name}\nLength${i+1}=-1`).join('\n'); } return '#EXTM3U\n' + channelsToExport.map(ch => `${buildUpdatedExtinf(ch.originalExtinf, ch.groups, ch.logo, ch.name, ch.chno)}\n${ch.url}`).join('\n\n'); }
        function savePlaylist() { const c = createPlaylistContent('m3u'); if(c) downloadFile(c, 'playlist.m3u', 'text/plain;charset=utf-8'); }
        function savePlaylistAsM3u8() { const c = createPlaylistContent('m3u8'); if(c) downloadFile(c, 'application/x-mpegurl;charset=utf-8'); }
        function savePlaylistAsPls() { const c = createPlaylistContent('pls'); if(c) downloadFile(c, 'playlist.pls', 'text/plain;charset=utf-8'); }
        function downloadFile(content, fileName, mimeType) { const blob = new Blob([content], { type: mimeType }); const a = document.createElement('a'); a.href = URL.createObjectURL(blob); const prefix = isMerged ? 'merged_' : isSorted ? 'sorted_' : ''; a.download = prefix + fileName; document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(a.href); }
        document.addEventListener('click', e => { if (e.target.classList.contains('edit-btn')) openEditModal(parseInt(e.target.dataset.index)); if (e.target.classList.contains('delete-btn-icon')) deleteChannel(parseInt(e.target.dataset.index)); });
        window.onclick = e => document.querySelectorAll('.modal').forEach(m => { if (e.target === m) closeModal(m.id); });
        function openBulkEditGroupModal() { if (selectedIndices.size === 0) return; document.getElementById('bulkNewGroupName').value = ''; openModal('bulkEditGroupModal'); }
        function executeBulkEditGroup() { const newGroups = document.getElementById('bulkNewGroupName').value.split(';').map(g => g.trim()).filter(g => g); const count = selectedIndices.size; selectedIndices.forEach(index => { channelsData[index].groups = newGroups; }); updateTvgChnoInAllChannels(); selectedIndices.clear(); searchChannels(); closeModal('bulkEditGroupModal'); showToast(`ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ù…Ø¬Ù…ÙˆØ¹Ø© ${count} Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success'); }
        function exportSelected() { if (selectedIndices.size === 0) return; const selectedChannels = Array.from(selectedIndices).map(index => channelsData[index]); const content = createPlaylistContent('m3u', selectedChannels); if(content) { downloadFile(content, 'selected_channels.m3u', 'text/plain;charset=utf-8'); showToast(`ØªÙ… ØªØµØ¯ÙŠØ± ${selectedChannels.length} Ù‚Ù†Ø§Ø© Ø¨Ù†Ø¬Ø§Ø­`, 'success'); selectedIndices.clear(); searchChannels(); } }
        function openChannelCheckerModal() { if (channelsData.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„ÙØ­ØµÙ‡Ø§", "error"); document.getElementById('checker-progress-text').textContent = 'Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¨Ø¯Ø¡...'; const progressBar = document.getElementById('checker-progress-bar'); progressBar.style.width = '0%'; progressBar.textContent = '0%'; document.getElementById('checker-summary-text').textContent = ''; document.getElementById('start-check-btn').style.display = 'inline-block'; document.getElementById('stop-check-btn').style.display = 'none'; openModal('channelCheckerModal'); }
        function stopChannelCheck() { isChecking = false; showToast("ØªÙ… Ø¥ÙŠÙ‚Ø§Ù ÙØ­Øµ Ø§Ù„Ù‚Ù†ÙˆØ§Øª.", "info"); }
        async function executeChannelCheck() { isChecking = true; document.body.classList.add('show-status-dots'); displayPaginatedChannels(); document.getElementById('start-check-btn').style.display = 'none'; document.getElementById('stop-check-btn').style.display = 'inline-block'; const progressText = document.getElementById('checker-progress-text'); const progressBar = document.getElementById('checker-progress-bar'); const summaryText = document.getElementById('checker-summary-text'); let okCount = 0; let failCount = 0; const total = channelsData.length; for (let i = 0; i < total; i++) { if (!isChecking) break; const channel = channelsData[i]; channel.status = 'checking'; updateStatusDot(i, 'checking'); const progress = Math.round(((i + 1) / total) * 100); progressText.textContent = `Ø¬Ø§Ø±ÙŠ ÙØ­Øµ Ø§Ù„Ù‚Ù†Ø§Ø© ${i + 1} Ù…Ù† ${total}...`; progressBar.style.width = `${progress}%`; progressBar.textContent = `${progress}%`; const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), 5000); try { const response = await fetch(channel.url, { method: 'HEAD', signal: controller.signal, mode: 'no-cors' }); channel.status = 'checked-ok'; okCount++; } catch (error) { channel.status = 'checked-fail'; failCount++; } finally { clearTimeout(timeoutId); updateStatusDot(i, channel.status); } } isChecking = false; summaryText.textContent = `Ø§ÙƒØªÙ…Ù„ Ø§Ù„ÙØ­Øµ: ${okCount} Ù‚Ù†Ø§Ø© ØªØ¹Ù…Ù„, ${failCount} Ù‚Ù†Ø§Ø© Ù„Ø§ ØªØ¹Ù…Ù„.`; document.getElementById('start-check-btn').style.display = 'inline-block'; document.getElementById('stop-check-btn').style.display = 'none'; }
        function updateStatusDot(originalIndex, status) { const dot = document.querySelector(`.status-dot[data-index="${originalIndex}"]`); if (dot) { dot.className = `status-dot ${status}`; } }
        function openFindReplaceModal() { if (channelsData.length === 0) return showToast("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù‚Ù†ÙˆØ§Øª Ù„Ù„Ø¨Ø­Ø« ÙÙŠÙ‡Ø§", "error"); document.getElementById('find-text').value = ''; document.getElementById('replace-text').value = ''; document.getElementById('replace-scope-all').checked = true; document.getElementById('replace-scope-selected').disabled = selectedIndices.size === 0; if (selectedIndices.size > 0) { document.getElementById('replace-scope-selected').checked = true; } openModal('findReplaceModal'); }
        function executeFindAndReplace() { const findText = document.getElementById('find-text').value; const replaceText = document.getElementById('replace-text').value; if (!findText) { return showToast("Ø­Ù‚Ù„ 'Ø¨Ø­Ø« Ø¹Ù†' Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ§Ø±ØºÙ‹Ø§.", "error"); } const findInName = document.getElementById('find-in-name').checked; const findInGroup = document.getElementById('find-in-group').checked; const findInUrl = document.getElementById('find-in-url').checked; if (!findInName && !findInGroup && !findInUrl) { return showToast("Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ø­Ù‚Ù„ ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø¨Ø­Ø« ÙÙŠÙ‡.", "error"); } const scope = document.querySelector('input[name="replace-scope"]:checked').value; const targetIndices = (scope === 'selected') ? Array.from(selectedIndices) : channelsData.map((_, i) => i); let replacedCount = 0; let affectedChannels = 0; targetIndices.forEach(index => { const channel = channelsData[index]; let channelModified = false; if (findInName && channel.name && channel.name.includes(findText)) { const original = channel.name; channel.name = channel.name.replaceAll(findText, replaceText); replacedCount += (original.match(new RegExp(findText, "g")) || []).length; channelModified = true; } if (findInGroup && channel.groups && channel.groups.length > 0) { const originalGroups = [...channel.groups]; channel.groups = channel.groups.map(group => { if (group.includes(findText)) { replacedCount += (group.match(new RegExp(findText, "g")) || []).length; channelModified = true; return group.replaceAll(findText, replaceText); } return group; }); } if (findInUrl && channel.url && channel.url.includes(findText)) { const original = channel.url; channel.url = channel.url.replaceAll(findText, replaceText); replacedCount += (original.match(new RegExp(findText, "g")) || []).length; channelModified = true; } if (channelModified) { affectedChannels++; } }); updateTvgChnoInAllChannels(); searchChannels(); closeModal('findReplaceModal'); showToast(`ØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù†Øµ ${replacedCount} Ù…Ø±Ø© ÙÙŠ ${affectedChannels} Ù‚Ù†Ø§Ø©.`, 'success'); }
    </script>
</body>
</html>
